<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detalle de Recipe</title>
    <script>
        (function() {
        const token = localStorage.getItem('token');
        if (!token) {
            console.warn("GUARDIA (Inmediato): No hay token. Redirigiendo...");
            // Si no hay token, patea al usuario al login
            window.location.replace('/index.html'); 
        }
    })();

    // 2. Verificación para el BFCache (cuando usa el botón "Atrás")
    window.addEventListener('pageshow', function(event) {
        // event.persisted es true si la página vino del cache
        if (event.persisted) {
            console.log("GUARDIA (PageShow): Página cargada desde BFCache. Verificando...");
            const token = localStorage.getItem('token');
            if (!token) {
                // Si volvió sin token, lo pateamos de nuevo
                window.location.replace('/index.html');
            }
        }
    });
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;700&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="/CSS/styles.css" />
    <style>
        .validation-error {
            color: #dc3545;
            font-size: 0.875em;
            display: none;
            margin-top: .25rem;
        }
    </style>
  </head>
  <body class="body-line">
    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container-fluid">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="main-nav-links">
                <li class="nav-item"><a class="nav-link" href="squeegee-hp.html">Squeegee</a></li>
                <li class="nav-item"><a class="nav-link" href="stencil-hp.html">Stencil</a></li>
                <li class="nav-item"><a class="nav-link" href="plate-hp.html">Plate</a></li>
                <li class="nav-item"><a class="nav-link active" href="recipes.html">RECIPES</a></li>
                <li class="nav-item" id="get-users"><a class="nav-link" href="users-hp.html">Users</a></li>
                <li class="nav-item"><a class="nav-link" href="imprimir.html">Imprimir</a></li>
            </ul>
            <div class="d-flex align-items-center">
                <a href="adminIndex.html" class="btn nav-icon-btn"><i class="bi bi-house-door-fill"></i></a>
                <a href="#" class="btn logout-btn" id="logout-button">Cerrar sesión</a>
            </div>
        </div>
    </nav>
    <main class="main-content-recipe">
      <div class="container-fluid p-4">
        <div class="page-header-container mb-4">
          <h1 class="page-title" id="main-recipe-title"></h1>
        </div>
        <h3 class="text-muted mb-4" id="recipe-pn-display"></h3>
        <div class="d-flex justify-content-between align-items-center mb-4">
          <ul class="nav nav-pills sub-navbar mb-3" id="toolingTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="stencils-tab" data-bs-toggle="tab" data-bs-target="#stencils-content" type="button" role="tab" aria-controls="stencils-content" aria-selected="true"> Stencils </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="squeegees-tab" data-bs-toggle="tab" data-bs-target="#squeegees-content" type="button" role="tab" aria-controls="squeegees-content" aria-selected="false"> Squeegees </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="plates-tab" data-bs-toggle="tab" data-bs-target="#plates-content" type="button" role="tab" aria-controls="plates-content" aria-selected="false"> Plates </button>
            </li>
          </ul>
          <div class="d-flex align-items-center search-actions">
            <div class="input-group search-bar">
              <input type="text" id="table-search-input" class="form-control" placeholder="Búsqueda..." />
              <span class="input-group-text"><i class="bi bi-search"></i></span>
            </div>
            <button class="btn btn-icon-round ms-3" id="edit-model-btn"> <i class="bi bi-pen"></i> </button>
          </div>
        </div>

        <div class="tab-content" id="toolingTabsContent">
          <div class="tab-pane fade show active" id="stencils-content" role="tabpanel" aria-labelledby="stencils-tab">
            <div class="table-responsive">
              <table class="table table-striped table-hover custom-table">
                <thead>
                  <tr>
                    <th>#</th> <th>Barcode</th> <th>Serie</th> <th>Versión</th> <th>Grosor</th> <th>Status</th> <th></th> <th></th>
                  </tr>
                </thead>
                <tbody id="stencils-table-body"></tbody>
              </table>
            </div>
          </div>
          <div class="tab-pane fade" id="squeegees-content" role="tabpanel" aria-labelledby="squeegees-tab">
            <div class="table-responsive">
              <table class="table table-striped table-hover custom-table">
                <thead>
                  <tr>
                    <th>#</th> <th>Barcode</th> <th>Largo (mm)</th> <th>Status</th> <th></th> <th></th>
                  </tr>
                </thead>
                <tbody id="squeegees-table-body"></tbody>
              </table>
            </div>
          </div>
          <div class="tab-pane fade" id="plates-content" role="tabpanel" aria-labelledby="plates-tab">
            <div class="table-responsive">
              <table class="table table-striped table-hover custom-table">
                <thead>
                  <tr>
                    <th>#</th> <th>Barcode</th> <th>Serie</th> <th>Status</th> <th></th> <th></th>
                  </tr>
                </thead>
                <tbody id="plates-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer-bar"></footer>

    <div class="modal fade" id="editModelModal" tabindex="-1" aria-labelledby="editModelModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModelModalLabel">Editar Modelo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editModelForm">
                        <div class="mb-3">
                            <label for="edit-model-qr" class="form-label">Pokayoke para plate</label>
                            <input type="text" class="form-control" id="edit-model-qr" maxlength="30">
                            <div id="edit-model-qr-error" class="validation-error"></div>
                        </div>

                        <div class="mb-3">
                            <label for="edit-model-pasta-select" class="form-label">Pasta</label>
                            <select class="form-select" id="edit-model-pasta-select">
                                <option value="" selected disabled>Cargando...</option>
                                <option value="Otro">Otro (Especificar)</option>
                            </select>
                            <div id="edit-model-pasta-select-error" class="validation-error"></div>
                        </div>
                        <div class="mb-3" id="edit-model-pasta-otro-container" style="display: none;">
                             <label for="edit-model-pasta-otro" class="form-label">Especificar Nueva Pasta</label>
                             <input type="text" class="form-control" id="edit-model-pasta-otro" maxlength="20">
                             <div id="edit-model-pasta-otro-error" class="validation-error"></div>
                        </div>
                         <div class="mb-3">
                            <label for="edit-model-length" class="form-label">Largo (mm)</label>
                            <input type="text" class="form-control" id="edit-model-length" maxlength="5">
                             <div id="edit-model-length-error" class="validation-error"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="saveModelChangesBtn">Guardar cambios</button>
                </div>
            </div>
        </div>
    </div>
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/JS/authFetch.js"></script>
    <script src="/JS/globalAdmin.js"></script>
     <script src="/JS/recipe-detail.js"></script>
  </body>
</html>